FROM quay.io/jupyter/datascience-notebook:python-3.11.9
#FROM jupyter/datascience-notebook:d53a302fbcd0

USER root
ENV DEBCONF_NOWARNINGS yes

# ãƒ™ãƒ¼ã‚¹OSãŒ Ubuntu Noble (24.04) ã§ã‚ã‚‹ãŸã‚ã€PostgreSQLãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ ã‚’ 'noble' ã«è¨­å®š
ARG DISTRO_CODENAME="noble"

# PostgreSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
SHELL ["/bin/bash", "-o", "pipefail", "-c"]
RUN apt-get update \
    # éµå–å¾—ã¨ãƒªãƒã‚¸ãƒˆãƒªè¨­å®šã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    && apt-get install -y --no-install-recommends gnupg wget \
    \
    # PostgreSQL GPGã‚­ãƒ¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨é…ç½®
    && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | gpg --dearmor -o /usr/share/keyrings/postgres-archive-keyring.gpg \
    \
    # APTã‚½ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã«ãƒªãƒã‚¸ãƒˆãƒªã¨ç½²åæƒ…å ±ã‚’è¿½åŠ ã€‚ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ ã« ${DISTRO_CODENAME} (noble) ã‚’ä½¿ç”¨
    && echo "deb [signed-by=/usr/share/keyrings/postgres-archive-keyring.gpg] http://apt.postgresql.org/pub/repos/apt ${DISTRO_CODENAME}-pgdg main" > /etc/apt/sources.list.d/pgdg.list \
    \
    # ãƒªãƒã‚¸ãƒˆãƒªè¿½åŠ å¾Œã®æ›´æ–°
    && apt-get update \
    \
    # libpq-dev (PostgreSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    && apt-get install -y --no-install-recommends libpq-dev \
    \
    # ä¸è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    && apt-get remove -y gnupg wget \
    && apt-get autoremove -y \
    && rm -rf /var/lib/apt/lists/* \
               /opt/julia-*/share/julia/stdlib/v*/SuiteSparse/.devcontainer/Dockerfile \
               /opt/julia/packages/Pluto/*/.vscode/ \
    \
    # æ¨©é™ã®å¤‰æ›´ (å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ç¶­æŒ)
    && find / -type f -perm /u+s -ignore_readdir_race -exec chmod u-s {} \; \
    && find / -type f -perm /g+s -ignore_readdir_race -exec chmod g-s {} \;

---

## ğŸ’» ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒè¨­å®šã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```dockerfile
USER jovyan
WORKDIR /home/jovyan
COPY requirements.txt .
COPY Pipfile .
COPY Pipfile.lock .
COPY install.R .

# Python, Rã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
RUN pip install --no-cache-dir -r requirements.txt \
    && pipenv install --system \
    && Rscript install.R \
    && rm -rf requirements.txt Pipfile* install.R .cache/R/pkgcache/sysreqs/docker/*/Dockerfile /tmp/* /var/tmp/* .npm/

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®è¨­å®š
HEALTHCHECK --interval=5s --retries=20 CMD ["curl", "-s", "-S", "-o", "/dev/null", "http://localhost:8888"]
